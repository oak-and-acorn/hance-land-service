import { NextRequest, NextResponse } from 'next/server'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { message } = await request.json().catch(() => ({ message: 'Published changes' }))\n    \n    const token = process.env.GITHUB_TOKEN\n    if (!token) {\n      return NextResponse.json(\n        { error: 'GitHub token not configured' },\n        { status: 500 }\n      )\n    }\n\n    const owner = 'oak-and-acorn'\n    const repo = 'hance-land-service'\n    const baseBranch = 'main'\n    const headBranch = 'content/preview'\n    \n    // Create a merge request from preview to main\n    const response = await fetch(\n      `https://api.github.com/repos/${owner}/${repo}/merges`,\n      {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Accept': 'application/vnd.github.v3+json',\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          base: baseBranch,\n          head: headBranch,\n          commit_message: message || 'Published content changes',\n        }),\n      }\n    )\n\n    if (!response.ok) {\n      const error = await response.text()\n      console.error('GitHub merge failed:', error)\n      \n      if (response.status === 409) {\n        return NextResponse.json(\n          { error: 'No changes to publish or merge conflict detected' },\n          { status: 409 }\n        )\n      }\n      \n      return NextResponse.json(\n        { error: 'Failed to publish changes' },\n        { status: response.status }\n      )\n    }\n\n    const result = await response.json()\n    \n    return NextResponse.json({\n      success: true,\n      message: 'Changes published successfully',\n      sha: result.sha,\n    })\n    \n  } catch (error) {\n    console.error('Publish error:', error)\n    const errorMessage = error instanceof Error ? error.message : 'Unknown error'\n    return NextResponse.json(\n      { error: `Failed to publish: ${errorMessage}` },\n      { status: 500 }\n    )\n  }\n}