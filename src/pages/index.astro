---

import Layout from '../layouts/Layout.astro';
import { getCollection, getEntry, getEntryBySlug } from 'astro:content';
// Remove direct Markdoc import; use .rendered.Content from Astro Content Collections

// Load hero, about, and contact from static JSON (or migrate to .mdoc if desired)
import heroData from '../../content/hero.json';
import aboutData from '../../content/about.json';
import contactData from '../../content/contact.json';

import { render } from 'astro:content';

// Load and render services
let services = await getCollection('services');
services = await Promise.all(
  services
    .sort((a, b) => (a.data.order || 0) - (b.data.order || 0))
    .map(async (entry) => ({
      ...entry,
      renderedResult: entry.body ? await render(entry) : null,
    }))
);

// Load and render portfolio
let portfolio = await getCollection('portfolio');
portfolio = await Promise.all(
  portfolio
    .sort((a, b) => new Date(b.data.date || 0).getTime() - new Date(a.data.date || 0).getTime())
    .map(async (entry) => ({
      ...entry,
      renderedResult: entry.body ? await render(entry) : null,
    }))
);
---

<Layout title="Hance Land Service: Dependable Pond & Land Clearing Experts">
  <!-- Hero Section -->
  <section class="customizable-section py-16 md:py-24 lg:py-32 px-4 customizable-primary-bg relative overflow-hidden" id="hero" data-section="hero">
    <div class="absolute inset-0">
      <img src={heroData.image} alt="Hance Land Service Hero Image" class="w-full h-full object-cover opacity-30" />
    </div>
    <div class="relative z-10 max-w-6xl mx-auto flex flex-col lg:flex-row items-center justify-between">
      <div class="text-center lg:text-left lg:w-1/2 lg:pr-16 mb-10 lg:mb-0">
        <h1 class="customizable-heading customizable-heading-lg text-4xl sm:text-5xl lg:text-6xl font-bold mb-6 leading-tight text-white">
          {heroData.title}
        </h1>
        <p class="customizable-text text-lg lg:text-xl mb-8 text-white">
          {heroData.subtitle}
        </p>
        <div class="flex justify-center lg:justify-start">
          <a href="#contact" class="customizable-btn customizable-btn-primary px-8 py-4 rounded-lg font-bold text-lg shadow-lg hover:shadow-xl transition duration-300">
            {heroData.ctaText}
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- About Section -->
  <section class="customizable-section py-16 md:py-20 lg:py-24 px-4 bg-white dark:bg-gray-900" id="about" data-section="about">
    <div class="max-w-6xl mx-auto grid md:grid-cols-2 gap-12 items-center">
      <div class="text-center md:text-left">
        <h2 class="customizable-heading customizable-heading-md text-3xl md:text-4xl font-bold mb-6">{aboutData?.title}</h2>
        <div class="customizable-text mb-6 prose dark:prose-invert">
          {aboutData?.text && <p>{aboutData.text}</p>}
        </div>
        <div class="mt-10">
          <a href="#contact" class="customizable-btn customizable-btn-primary px-8 py-4 rounded-lg font-bold text-lg shadow-lg hover:shadow-xl transition duration-300">Get a Free Quote</a>
        </div>
      </div>
      <div class="flex justify-center md:justify-end">
        <div class="customizable-image rounded-2xl shadow-xl max-w-md">
          <img src={aboutData?.image} alt="Hance Land Service Team" class="rounded-2xl" />
        </div>
      </div>
    </div>
  </section>

  <!-- Services Section -->
  <section class="customizable-section py-16 md:py-20 lg:py-24 px-4 bg-gray-100 dark:bg-gray-800" id="services" data-section="services">
    <div class="max-w-6xl mx-auto">
      <h2 class="customizable-heading customizable-heading-md text-3xl md:text-4xl font-bold text-center mb-12">Our Services - Making Land Dreams Happen!</h2>
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-10">
        {services.map(service => (
          <div class="customizable-card p-6 shadow-lg bg-white dark:bg-gray-900 rounded-xl">
            {service.data.image && (
              <div class="customizable-image rounded-xl mb-6 overflow-hidden">
                <img src={service.data.image} alt={service.data.title} class="w-full h-48 object-cover" />
              </div>
            )}
            <h3 class="text-xl font-bold mb-4">{service.data.title}</h3>
            <div class="text-gray-700 dark:text-gray-300 prose dark:prose-invert">
              {service.body ? (
                service.renderedResult && service.renderedResult.Content ? <service.renderedResult.Content /> : <em>Rendered content missing</em>
              ) : <em>No description found</em>}
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Portfolio Section -->
  <section class="customizable-section py-16 md:py-20 lg:py-24 px-4 bg-white dark:bg-gray-900" id="portfolio" data-section="portfolio">
    <div class="max-w-6xl mx-auto">
      <h2 class="customizable-heading customizable-heading-md text-3xl md:text-4xl font-bold text-center mb-12">Our Work Speaks for Itself</h2>
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
        {portfolio.map(project => (
          <div class="customizable-card overflow-hidden shadow-lg rounded-xl bg-white dark:bg-gray-800">
            {project.data.images && project.data.images[0] && (
              <div class="customizable-image overflow-hidden">
                <img src={project.data.images[0]} alt={project.data.title} class="w-full h-64 object-cover hover:scale-105 transition duration-300" />
              </div>
            )}
            <div class="p-6">
              <div class="text-sm text-blue-600 dark:text-blue-400 mb-2">{project.data.category}</div>
              <h3 class="text-xl font-bold mb-2">{project.data.title}</h3>
              <div class="text-gray-700 dark:text-gray-300 prose dark:prose-invert">
                {project.body ? (
                  project.renderedResult && project.renderedResult.Content ? <project.renderedResult.Content /> : <em>Rendered content missing</em>
                ) : <em>No description found</em>}
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Contact Section -->
  <section class="customizable-section py-16 md:py-20 lg:py-24 px-4 bg-gray-100 dark:bg-gray-800" id="contact" data-section="contact">
    <div class="max-w-4xl mx-auto">
      <h2 class="customizable-heading customizable-heading-md text-3xl md:text-4xl font-bold text-center mb-6">Get in Touch</h2>
      <p class="text-lg mb-12 text-center text-gray-700 dark:text-gray-300">
        Ready to transform your land? Contact us today for a free consultation!
      </p>
      
      <div class="grid md:grid-cols-2 gap-8 mb-12">
        <!-- Contact Info -->
        <div class="space-y-6">
          <div class="customizable-card p-6 bg-white dark:bg-gray-900 rounded-xl shadow-lg">
            <h3 class="text-xl font-bold mb-4">Call Us</h3>
            <a href={`tel:${contactData?.phone}`} class="text-2xl text-blue-600 dark:text-blue-400 hover:underline">
              {contactData?.phone}
            </a>
          </div>
          
          <div class="customizable-card p-6 bg-white dark:bg-gray-900 rounded-xl shadow-lg">
            <h3 class="text-xl font-bold mb-4">Email Us</h3>
            <a href={`mailto:${contactData?.email}`} class="text-xl text-blue-600 dark:text-blue-400 hover:underline break-all">
              {contactData?.email}
            </a>
          </div>
          
          <div class="customizable-card p-6 bg-white dark:bg-gray-900 rounded-xl shadow-lg">
            <h3 class="text-xl font-bold mb-4">Location</h3>
            <p class="text-lg text-gray-700 dark:text-gray-300">{contactData?.address}</p>
          </div>
        </div>
        <!-- Contact Form -->
        <div class="bg-white dark:bg-gray-900 rounded-xl shadow-lg p-8">
          <h3 class="text-2xl font-bold mb-6">Send us a message</h3>
          <form name="contact" method="POST" data-netlify="true" netlify-honeypot="bot-field" class="space-y-4">
            <input type="hidden" name="form-name" value="contact" />
            <p class="hidden">
              <label>Don't fill this out: <input name="bot-field" /></label>
            </p>
            
            <div>
              <label for="name" class="block text-sm font-medium mb-2">Name *</label>
              <input type="text" id="name" name="name" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:text-white" />
            </div>
            
            <div>
              <label for="email" class="block text-sm font-medium mb-2">Email *</label>
              <input type="email" id="email" name="email" required class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:text-white" />
            </div>
            
            <div>
              <label for="phone" class="block text-sm font-medium mb-2">Phone</label>
              <input type="tel" id="phone" name="phone" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:text-white" />
            </div>
            
            <div>
              <label for="message" class="block text-sm font-medium mb-2">Message *</label>
              <textarea id="message" name="message" required rows="4" class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:text-white"></textarea>
            </div>
            
            <button type="submit" class="w-full customizable-btn customizable-btn-primary px-6 py-3 rounded-lg font-bold text-lg shadow-lg hover:shadow-xl transition duration-300">
              Send Message
            </button>
          </form>
        </div>
      </div>
    </div>
  </section>
</Layout>
